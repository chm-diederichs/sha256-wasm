
module.exports = loadWebAssembly

loadWebAssembly.supported = typeof WebAssembly !== 'undefined'

function loadWebAssembly (opts) {
  if (!loadWebAssembly.supported) return null

  var imp = opts && opts.imports
  var wasm = toUint8Array('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')
  var ready = null

  var mod = {
    buffer: wasm,
    memory: null,
    exports: null,
    realloc: realloc,
    onload: onload
  }

  onload(function () {})

  return mod

  function realloc (size) {
    mod.exports.memory.grow(Math.max(0, Math.ceil(Math.abs(size - mod.memory.length) / 65536)))
    mod.memory = new Uint8Array(mod.exports.memory.buffer)
  }

  function onload (cb) {
    if (mod.exports) return cb()

    if (ready) {
      ready.then(cb.bind(null, null)).catch(cb)
      return
    }

    try {
      if (opts && opts.async) throw new Error('async')
      setup({instance: new WebAssembly.Instance(new WebAssembly.Module(wasm), imp)})
    } catch (err) {
      ready = WebAssembly.instantiate(wasm, imp).then(setup)
    }

    onload(cb)
  }

  function setup (w) {
    mod.exports = w.instance.exports
    mod.memory = mod.exports.memory && mod.exports.memory.buffer && new Uint8Array(mod.exports.memory.buffer)
  }
}

function toUint8Array (s) {
  if (typeof atob === 'function') return new Uint8Array(atob(s).split('').map(charCodeAt))
  return (require('buf' + 'fer').Buffer).from(s, 'base64')
}

function charCodeAt (c) {
  return c.charCodeAt(0)
}
